<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GOC Menu Diagnostics</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:20px;background:#0b1220;color:#fff}
  .card{background:#111a30;border:1px solid #223255;border-radius:12px;padding:16px;margin:0 0 16px 0}
  h1{font-size:20px;margin:0 0 12px}
  .row{display:flex;flex-wrap:wrap;gap:8px}
  .pill{padding:6px 10px;border-radius:999px;font-size:13px;border:1px solid #334d7a}
  .ok{background:#103d25;border-color:#1f7a4c;color:#b8f7d2}
  .warn{background:#3d2d10;border-color:#7a5a1f;color:#f7e3b8}
  .bad{background:#3d1010;border-color:#7a1f1f;color:#f7b8b8}
  code{background:#0a1327;border:1px solid #223255;padding:2px 6px;border-radius:6px}
  button{background:#234a8f;color:#fff;border:1px solid #3b6cc4;border-radius:8px;padding:8px 12px;cursor:pointer}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .small{font-size:12px;opacity:.8}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:700px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="card">
    <h1>GOC Menu Diagnostics</h1>
    <div class="small">Upload this file next to your <code>index.html</code>. Open it on your phone (Cloudflare or local server). Tap “Run Checks”.</div>
  </div>

  <div class="grid">
    <div class="card" id="summary">
      <h1>Summary</h1>
      <div class="row" id="tags"></div>
    </div>

    <div class="card">
      <h1>Actions</h1>
      <div class="row">
        <button id="run">Run Checks</button>
        <button id="tryOpen">Toggle Open</button>
        <button id="tryClose">Try Close</button>
      </div>
      <div style="margin-top:10px" class="small">After running, screenshot this page and share.</div>
    </div>
  </div>

  <div class="card">
    <h1>Details</h1>
    <div id="details" class="mono small">Not run yet.</div>
  </div>

<script>
(function(){
  const $ = (s, r) => (r||document).querySelector(s);
  const $$ = (s, r) => Array.from((r||document).querySelectorAll(s));
  const tags = $('#tags');
  const details = $('#details');

  function pill(text, cls){ const d=document.createElement('div'); d.className='pill '+cls; d.textContent=text; return d; }
  function addLine(txt){ const p=document.createElement('div'); p.textContent=txt; details.appendChild(p); }

  function getToggle(){
    const sels = ['[data-toggle-target]','.ct-header-trigger','.menu-toggle','.hamburger','.nav-toggle','.ct-toggle'];
    for (const s of sels){ const el=$(s); if (el) return {el, selector:s}; }
    return {el:null, selector:null};
  }
  function getPanel(){ return $('.ct-panel, .ct-drawer, .offcanvas, .mobile-menu, .ct-panel--mobile, #offcanvas'); }
  function getOverlay(){ return $('.ct-panel__backdrop, .ct-drawer-backdrop, .offcanvas-backdrop, .mobile-menu-overlay, .ct-backdrop'); }

  function isOpen(){
    return !!($('.is-open, .open, .ct-panel--visible, .ct-offcanvas-open, body.ct-open, body.menu-open, body.offcanvas-open'));
  }

  function run(){
    tags.innerHTML = ''; details.textContent='';

    const t = getToggle();
    const p = getPanel();
    const o = getOverlay();

    // Basic presence
    tags.appendChild(pill('Toggle: '+(t.el?'found':'missing'), t.el?'ok':'bad'));
    tags.appendChild(pill('Panel: '+(p?'found':'missing'), p?'ok':'bad'));
    tags.appendChild(pill('Overlay: '+(o?'found':'missing'), o?'ok':'bad'));

    addLine('Toggle selector: '+(t.selector||'none'));
    addLine('Panel selector: '+(p?('.'+(p.className||'')+'#'+(p.id||'')):'none'));
    addLine('Overlay selector: '+(o?('.'+(o.className||'')+'#'+(o.id||'')):'none'));

    // Styles that often cause "taps pass through"
    if (o){
      const cs = getComputedStyle(o);
      addLine('Overlay pointer-events: '+cs.pointerEvents);
      addLine('Overlay z-index: '+cs.zIndex);
      tags.appendChild(pill('Overlay PE: '+cs.pointerEvents, (cs.pointerEvents!=='none')?'ok':'bad'));
    }

    // JS presence
    const hasCt = !!(window.ctDrawer && typeof window.ctDrawer.init==='function');
    const hasElem = !!(window.elementorFrontend && typeof window.elementorFrontend.init==='function');
    tags.appendChild(pill('ctDrawer: '+(hasCt?'yes':'no'), hasCt?'ok':'warn'));
    tags.appendChild(pill('elementorFrontend: '+(hasElem?'yes':'no'), hasElem?'ok':'warn'));

    addLine('ctDrawer.init present: '+hasCt);
    addLine('elementorFrontend.init present: '+hasElem);

    // Synthetic click test
    const before = isOpen();
    if (t.el){ t.el.click(); }
    const after = isOpen();
    if (o){ o.click(); }
    const afterClose = isOpen();

    tags.appendChild(pill('Click toggled: '+(after!==before), (after!==before)?'ok':'bad'));
    tags.appendChild(pill('Overlay closes: '+(!afterClose), (!afterClose)?'ok':'bad'));

    addLine('Before open: '+before);
    addLine('After open: '+after);
    addLine('After overlay close: '+afterClose);

    // Report any missing JS files (best effort) by scanning <script src>
    const scripts = $$('script[src]');
    const bad = scripts.filter(s=> s.src && (s.dataset && s.dataset.from==='wp') && (s.getAttribute('data-httrack')==='missing'));
    addLine('Script tags on page: '+scripts.length);
  }

  function tryOpen(){
    const t=getToggle(); if (t.el){ t.el.click(); }
  }
  function tryClose(){
    const o=getOverlay(); if (o){ o.click(); }
  }

  window.addEventListener('load', run);
  $('#run').addEventListener('click', run);
  $('#tryOpen').addEventListener('click', tryOpen);
  $('#tryClose').addEventListener('click', tryClose);
})();
</script>
</body>
</html>
